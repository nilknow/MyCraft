<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Three.js Cube</title>
    <style>
      body {
        margin: 0;
      }

      canvas {
        display: block;
      }
    </style>
</head>
<body>
<div id="camera-switch" style="position: absolute">
    <button id="first-person-camera">
        first person
    </button>
    <button id="top-down-camera">
        top down
    </button>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="lib/cannon.min.js"></script>
<script src="lib/noisejs/perlin.js"></script>
<script type="module">
    import {updatePhysics, initWorld, initGround} from "./js/cannon.js";
    import {initMap} from "./js/map.js";
    import {firstPersonCameraListener, topDownCameraListener, mouseControl} from "./js/control.js";
    import {topDownCamera, firstPersonCamera, currentCamera, updateCamera} from "./js/camera.js";
    import {player} from "./js/player.js";
    import {directionalLight, ambientLight} from "./js/light.js"
    import {renderer} from "./js/render.js"
    // Scene
    const scene = new THREE.Scene();

    // 创建物理世界
    let world = initWorld();
    initGround(world)

    // Camera
    scene.add(currentCamera);
    scene.add(firstPersonCamera);

    //light
    scene.add(ambientLight());
    scene.add(directionalLight());

    // 创建玩家模型
    scene.add(player);

    // 创建玩家物理体
    const playerShape = new CANNON.Box(new CANNON.Vec3(1, 2, 1));
    const playerBody = new CANNON.Body({mass: 1, shape: playerShape});
    playerBody.position.copy(player.position);
    world.addBody(playerBody);

    const group = new THREE.Group();
    initMap(group)
    scene.add(group);

    // 键盘事件监听
    mouseControl()
    topDownCameraListener();
    firstPersonCameraListener()

    // Animation loop
    function animate() {
        requestAnimationFrame(animate);
        updatePhysics(world, player)
        updateCamera()
        renderer.render(scene, currentCamera);
    }

    animate();
</script>
</body>
</html>